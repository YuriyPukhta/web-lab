<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>JS Bin</title>

<link rel="stylesheet" type="text/css" href="css/menu.css">
<link rel="stylesheet" type="text/css" href="css/account.css">
<script>
const get_list_created = "http://localhost:6996/buy"
const get_list_bought = "http://localhost:6996/tickets"

async function GetUserList(e) 
{
  alert(e.target.value);
  var url;
  var token = localStorage.getItem('token');
  if(token == null)
  {
    window.location.replace("./login.html");
  }
  const query =  e.target.value
  if (query =='bought'){
    url = get_list_bought;
  }
  else if(query == 'created'){
    url = get_list_created;
  }
  else{
    return 0;
  }
  var myList = document.getElementById('id-list');

  let h = new Headers({
      'Access-Control-Allow-Origin': '*'
  });
  let auth = 'Bearer ' + token;
  h.append('Authorization', auth);
  console.log(auth);
  const request = new Request(url, 
  {
    method: 'GET',
    credentials: 'same-origin',
    mode:'cors',
    headers: h
  });
 
  const response = await fetch(request).then(async (response) => {
     console.log(response.status);
     /response.json()/
     var res= await response.json();
    if(response.status == 200){
      console.log(':)))');
      /*window.location.replace("http://stackoverflow.com");*/
    }
    else if(response.status == 401){
      console.log(':)))');
      /*window.location.replace("./login");*/
    }
    else{
      console.log(':(((');
      return 0;
    }
    console.log(res)
    myList.innerHTML = '';
    for (var i = 0; i < res.length; i++) {
            var ticket = res[i]
            var name; 
            if (ticket.name == null){
              name = ticket.namefilm;
            }
            else{
              name = ticket.name;
            }
            let li = document.createElement("li");
            li.className = "list-element";
            var a = document.createElement('a');
            console.log(ticket);
            a.textcontent = ticket.id
            let linkText = document.createTextNode(name);
            a.appendChild(linkText);
            a.href = url+'/ticket?id='+ticket.id;

            li.appendChild(a);
            myList.appendChild(li);
    }
  return 0;
});
}



</script>
</head>

    <header>
      <div class = "main">
      <nav class = 'menu'>
          <ul class ="menu-ul">
            <li class ="menu-li" id = "home"><a href="account.html" class = "menu-li-a">logout</a></li>
            <li class ="menu-li"><a href="search.html" class = "menu-li-a">Events</a></li>
            <li class ="menu-li"><a href="create-tiket.html" class = "menu-li-a">Create tiket</a></li>
            <li class ="menu-li"><a href="login.html" class = "menu-li-a">login</a></li>
          </ul>
      </nav>
    </div>
  </header>
  <br>
  <br>
  <br>
  <br>
  
        <div class = "list">
        <div class = "up-user-interface">
                <button class = "User-button" onclick="document.getElementById('id').style.display='block'" style="width:auto;">Change your self</button> 
                <button class = "User-button-create" onclick="document.getElementById('id').style.display='block'" style="width:auto;">Change your self</button>
     <select onchange="GetUserList(event)" class = "list-of-ticket" id="Status" name="Status">
     <option value="">List of ticket</option>
      <option value="created">List of created ticket</option>
      <option value="bought">List of bought or booked ticket</option>
    </select>
        </div>

        

        <ul class = "list-ul" id = 'id-list'>
            <li class = "list-element"><a href="#news">Ticket 1</a</li>
            <li class = "list-element"><a href="#news">Ticket 2</a</li>
            <li class = "list-element"><a href="#news">Ticket 3</a</li>
            <li class = "list-element"><a href="#news">Ticket 4</a</li>
            <li class = "list-element"><a href="#news">Ticket 5</a</li>
            <li class = "list-element"><a href="#news">Ticket 6</a</li>
            <li class = "list-element"><a href="#news">Ticket 7</a</li>
            <li class = "list-element"><a href="#news">Ticket 8</a</li>
            <li class = "list-element"><a href="#news">Ticket 9</a</li>
            <li class = "list-element"><a href="#news">Ticket 10</a</li>
            <li class = "list-element"><a href="#news">Ticket 11</a</li>
            <li class = "list-element"><a href="#news">Ticket 12</a</li>
        </ul>
        </div>
    <div id = 'id'  class = "content">
      <form class = "change-user-info">
      <p>change your info</p>
      <label for="email">Email</label>
      <input type="text" placeholder="Enter Email" name="email" >

      <label for="psw">Password</label>
      <input type="text" placeholder="Enter Password" name="psw" >

      <label for="psw-repeat">Repeat Password</label>
      <input type="text" placeholder="Repeat Password" name="psw-repeat" >
     
      <input type="submit" value="Submit">
      </from>
      <style>

        </style>
    </head>
    <body>
    <script>

    var modal = document.getElementById('id');

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
}
</script>
  <br>
    </div>     
    </body>
</html>

